<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Complete-installation ‚Ä¢ canObsR</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Complete-installation">
</head>
<body>
<p>








  pkgdown/custom.css

  

  </p>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    pkgdown/home.html

    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">canObsR</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Unreleased version">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/umr-amap/canObsR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Complete-installation</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/umr-amap/canObsR/blob/master/vignettes/Complete-installation.Rmd" class="external-link"><code>vignettes/Complete-installation.Rmd</code></a></small>
      <div class="d-none name"><code>Complete-installation.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="why-the-installation-process-is-more-complex">Why the installation process is more complex<a class="anchor" aria-label="anchor" href="#why-the-installation-process-is-more-complex"></a>
</h2>
<p>The installation of canObsR involves several steps that go beyond a
typical R package. This is because the package acts as a bridge between
different powerful tools used for processing imagery. Here‚Äôs why:</p>
<p>Python integration: Some key processing steps rely on specialized
Python libraries. To make this work seamlessly from R, we use the
{reticulate} package, which requires setting up a Python environment via
Miniconda. This allows us to run Python scripts directly from R
functions.</p>
<p>Environment setup: We provide a .yml file to create a dedicated
Python environment with all the required dependencies. This ensures that
the Python code used in the package runs reliably, regardless of the
user‚Äôs system.</p>
<p>Metashape integration: Some image processing steps rely on Agisoft
Metashape, a commercial software. To use these features, Metashape must
be installed, and a valid license key must be activated.</p>
<p>Although the setup may seem complex at first, it ensures that once
installed, all components work together smoothly to provide robust and
reproducible results across platforms.</p>
<p>canObsR is a R package # üì• Install R, Rtools et RStudio</p>
<div class="section level4">
<h4 id="r-download-and-install-the-last-version-of-r-on-the-cran-r">üîπ R : Download and install the last version of R on the <a href="https://cran.r-project.org/" class="external-link">CRAN R</a><a class="anchor" aria-label="anchor" href="#r-download-and-install-the-last-version-of-r-on-the-cran-r"></a>
</h4>
</div>
<div class="section level4">
<h4 id="rtools-download-and-install-cran-rtools">üîπ Rtools : Download and install <a href="https://cran.rstudio.com/" class="external-link">CRAN Rtools</a><a class="anchor" aria-label="anchor" href="#rtools-download-and-install-cran-rtools"></a>
</h4>
</div>
<div class="section level4">
<h4 id="rstudio-download-and-install-rstudio-desktop">üîπ RStudio : Download and install <a href="https://posit.co/download/rstudio-desktop/" class="external-link">RStudio
Desktop</a><a class="anchor" aria-label="anchor" href="#rstudio-download-and-install-rstudio-desktop"></a>
</h4>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="install-canobsr">üì¶ Install <strong>canObsR</strong><a class="anchor" aria-label="anchor" href="#install-canobsr"></a>
</h2>
<p><em>In RStudio console</em></p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"devtools"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://devtools.r-lib.org/" class="external-link">devtools</a></span><span class="op">)</span></span>
<span><span class="fu">install_github</span><span class="op">(</span><span class="st">"https://github.com/umr-amap/canObsR.git"</span><span class="op">)</span></span></code></pre></div>
<hr>
</div>
<div class="section level2">
<h2 id="install-miniconda">‚öôÔ∏è Install Miniconda<a class="anchor" aria-label="anchor" href="#install-miniconda"></a>
</h2>
<p><em>In RStudio console</em></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"reticulate"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/reticulate/" class="external-link">reticulate</a></span><span class="op">)</span></span>
<span><span class="fu">reticulate</span><span class="fu">::</span><span class="fu"><a href="https://rstudio.github.io/reticulate/reference/install_miniconda.html" class="external-link">install_miniconda</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<hr>
</div>
<div class="section level2">
<h2 id="create-and-configurate-the-conda-environment">üèó Create and configurate the conda environment<a class="anchor" aria-label="anchor" href="#create-and-configurate-the-conda-environment"></a>
</h2>
<p><em>In RStudio console</em></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">YAML_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"PYTHON/environment.yaml"</span>, package <span class="op">=</span> <span class="st">"canObsR"</span><span class="op">)</span></span>
<span><span class="va">envname</span> <span class="op">&lt;-</span> <span class="st">"CanObsR-env"</span></span>
<span></span>
<span><span class="co"># Create environment from YAML file</span></span>
<span><span class="fu"><a href="https://rstudio.github.io/reticulate/reference/conda-tools.html" class="external-link">conda_create</a></span><span class="op">(</span></span>
<span>  envname <span class="op">=</span> <span class="va">envname</span>,</span>
<span>  YAML_file <span class="op">=</span> <span class="va">file</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Install gdal, rasterio and arosic in "CanObsR-env " </span></span>
<span><span class="fu"><a href="https://rstudio.github.io/reticulate/reference/conda-tools.html" class="external-link">conda_install</a></span><span class="op">(</span></span>
<span>  envname <span class="op">=</span> <span class="st">"CanObsR-env-mini"</span>,</span>
<span>  packages <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"gdal"</span>, <span class="st">"rasterio"</span>, <span class="st">"arosics"</span><span class="op">)</span>,</span>
<span>  channel <span class="op">=</span> <span class="st">"conda-forge"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<hr>
</div>
<div class="section level2">
<h2 id="install-de-metashape">üèó Install de Metashape<a class="anchor" aria-label="anchor" href="#install-de-metashape"></a>
</h2>
<p>The environment you just created contains already all necessary
dependences but the Metashape python API, which is required to align
photos using TimeSIFT.</p>
<p>üîª Download the .whl file here : <a href="https://www.agisoft.com/downloads/installer/" class="external-link uri">https://www.agisoft.com/downloads/installer/</a></p>
<p>Go to the ‚ÄúPython 3 module‚Äù section and click on the link
corresponding to your operating system. This should download a file
named ‚ÄúMetashape[‚Ä¶].whl‚Äù. Then, copy the path to the downloaded .whl
file below</p>
<p><em>In RStudio console</em></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">whl_file</span> <span class="op">&lt;-</span> <span class="st">".../Metashape-2.2.1-cp37.cp38.cp39.cp310.cp311-none-win_amd64.whl"</span></span>
<span></span>
<span><span class="fu"><a href="https://rstudio.github.io/reticulate/reference/use_python.html" class="external-link">use_condaenv</a></span><span class="op">(</span><span class="st">"CanObsR-env-mini"</span>, required <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="va">whl_file</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Installation of Metashape from the .whl file‚Ä¶"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rstudio.github.io/reticulate/reference/py_install.html" class="external-link">py_install</a></span><span class="op">(</span></span>
<span>    packages <span class="op">=</span> <span class="va">whl_file</span>,</span>
<span>    method <span class="op">=</span> <span class="st">"pip"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/warning.html" class="external-link">warning</a></span><span class="op">(</span><span class="st">"‚ùåÔ∏è File .whl not found : "</span>, <span class="va">whl_file</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rstudio.github.io/reticulate/reference/py_module_available.html" class="external-link">py_module_available</a></span><span class="op">(</span><span class="st">"Metashape"</span><span class="op">)</span> <span class="co"># Should be TRUE</span></span></code></pre></div>
<hr>
</div>
<div class="section level2">
<h2 id="metashape-license-activation">üîë Metashape license activation<a class="anchor" aria-label="anchor" href="#metashape-license-activation"></a>
</h2>
<p>Your python environment should be ready for use now. However, Agisoft
Metashape requires a paid license in order to access all its features.
It is not necessary to have the Metashape application installed on your
device in order for the python API to work, but whether or not the
application is installed and/or activated, the API still needs to be
activated using a license key (it can be the same used for the
application if it is already installed).</p>
<p><em>In RStudio console</em></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"reticulate"</span><span class="op">)</span></span>
<span><span class="fu">reticulate</span><span class="fu">::</span><span class="fu"><a href="https://rstudio.github.io/reticulate/reference/py_run.html" class="external-link">py_run_string</a></span><span class="op">(</span><span class="st">"</span></span>
<span><span class="st">import Metashape</span></span>
<span><span class="st"># Replace 'XXXXX-XXXXX-XXXXX-XXXXX-XXXXX' with your key</span></span>
<span><span class="st">license_key = 'XXXXX-XXXXX-XXXXX-XXXXX-XXXXX'</span></span>
<span><span class="st">if Metashape.license().activate(license_key):</span></span>
<span><span class="st">    print('‚úÖ Metashape Licence activated with success.')</span></span>
<span><span class="st">else:</span></span>
<span><span class="st">    print('‚ùå Metashape License not activated.')</span></span>
<span><span class="st">"</span><span class="op">)</span></span></code></pre></div>
<p>Or you can also do it using the Anaconda command prompt</p>
<p>To activate the key, follow these steps :</p>
<ul>
<li>Open an anaconda command prompt</li>
<li>Activate the environnement you just created : $ conda activate
canObs_env</li>
<li>start python and activate the licence : $ python &gt;&gt;&gt; import
Metashape &gt;&gt;&gt; Metashape.license.activate(‚ÄúAAAA-BBBB-CCCC-DDDD‚Äù)
# replace with your license key</li>
</ul>
<p>If that works, you can close the command prompt. You should be good
to go ! üéâ</p>
<hr>
<p>Re start R and<br><em>In RStudio console</em></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/reticulate/" class="external-link">reticulate</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/umr-amap/canObsR" class="external-link">canObsR</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rstudio.github.io/reticulate/reference/use_python.html" class="external-link">use_condaenv</a></span><span class="op">(</span><span class="st">"CanObsR-env"</span>, required <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Hugo Leblanc.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer>
</div>



  pkgdown/footer.html

  
</body>
</html>
