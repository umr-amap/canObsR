<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Generate-crown-labels • canObsR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Generate-crown-labels">
</head>
<body>
<p>








  pkgdown/custom.css

  

  </p>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    pkgdown/home.html

    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">canObsR</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Unreleased version">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/umr-amap/canObsR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Generate-crown-labels</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/umr-amap/canObsR/blob/master/vignettes/Generate-crown-labels.Rmd" class="external-link"><code>vignettes/Generate-crown-labels.Rmd</code></a></small>
      <div class="d-none name"><code>Generate-crown-labels.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<hr>
<p>The ‘Generate crown labels’ article describes the process for (1)
extracting crown images from the othomosaics and (2) add labels to each
images (Fig 1).</p>
<div class="figure" style="text-align: center">
<img src="img/Generate-crown-labels.png" alt="Fig 1 : Generate crown labels process" width="100%"><p class="caption">
Fig 1 : Generate crown labels process
</p>
</div>
</div>
<div class="section level2">
<h2 id="requirements">Requirements<a class="anchor" aria-label="anchor" href="#requirements"></a>
</h2>
<hr>
<p>This step-by-step process requires :<br>
- crown delineation file compatible with the canObsR functions. Check <a href="https://umr-amap.github.io/canObsR/reference/Create-compatible-crown-delineation-file.html">the
Create compatible crowndelineation file article</a> for more
details.<br>
- Orthomosaics time-serie. Check <a href="https://umr-amap.github.io/canObsR/reference/Generate-and-align-orthomosaics.html">the
Generate and align orthomosaics article</a> for more details.</p>
<p>To run the following code you can download and unzip <a href="https://zenodo.org/uploads/14748367?token=eyJhbGciOiJIUzUxMiJ9.eyJpZCI6ImVhNjBlZWM5LWYwZTEtNGUxNS04ZDRmLWI3MTAwZTdiMTdmNSIsImRhdGEiOnt9LCJyYW5kb20iOiIzYmViYTgxNWE2OGNlYTA1Zjc1YzdmMWUzZTdjZTVkMSJ9.pzx-dAnjJXNp34OIpqfibrHxZxSUSj8FvdLPGd6r4IaJSa5sAW-eme_EenQr0bLPUAjFGhKrZ-OqrVOQ7bLKBw" class="external-link">‘canObsR_data2.zip’</a>.</p>
</div>
<div class="section level2">
<h2 id="step-by-step-exemple">Step-by-step exemple<a class="anchor" aria-label="anchor" href="#step-by-step-exemple"></a>
</h2>
<hr>
<div class="section level3">
<h3 id="extract-crown-images">Extract crown images<a class="anchor" aria-label="anchor" href="#extract-crown-images"></a>
</h3>
<p>Set the <strong>mosa_path</strong> to the time series orthomosaics
folder, the <strong>crownFile_path</strong> to the crown delineation
file, the <strong>site</strong> name, the
<strong>Tmpfiles_directory</strong> if you want to store the temporary
files in a specific folder and <strong>N_cores</strong> the number of
cores you want to allocate for the parallelized functions*.</p>
<p>Note* : If you are using you own data, the function
<code>extract_crownsImages()</code> can produce a lot of temporary files
and need several GB of memory depending on the size, the resolution and
the number of mosaics. You can specify where you want to store the
temporary files.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">############## Load libraries --------------------------------------------------</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://umr-amap.github.io/canObsR/">canObsR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ycphs.github.io/openxlsx/index.html" class="external-link">openxlsx</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">############## Set parameters --------------------------------------------------</span></span>
<span></span>
<span><span class="va">canObsR_data2_folder</span> <span class="op">=</span> <span class="st">'XXXXX/canObsR_data2'</span></span>
<span></span>
<span><span class="co"># Path to the time-serie main directory</span></span>
<span><span class="va">mosa_path</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">canObsR_data2_folder</span>, <span class="st">'3_orthomosaics_aligned'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Path to the crown delineation file</span></span>
<span><span class="va">crownFile_path</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">canObsR_data2_folder</span>, <span class="st">'crowns.gpkg'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Path to the crown delineation file</span></span>
<span><span class="va">imgs_folder</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">canObsR_data2_folder</span>, <span class="st">'4_crowns_img'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Path to store the temp files</span></span>
<span><span class="va">Tmpfiles_directory</span> <span class="op">=</span> <span class="cn">NULL</span> <span class="co"># if NULL it use the default folder for tmp file. You can specify any folder</span></span>
<span></span>
<span><span class="co"># Dates of time-serie images</span></span>
<span><span class="va">dates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"20220427"</span>, <span class="st">"20220511"</span>, <span class="st">"20220525"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Number of cores used for the paralelized functions</span></span>
<span><span class="va">N_cores</span> <span class="op">=</span> <span class="fl">10</span></span>
<span></span>
<span><span class="co"># Site name</span></span>
<span><span class="va">site</span> <span class="op">=</span> <span class="st">'Bouamir'</span></span>
<span></span>
<span><span class="co"># Path to the mosaics</span></span>
<span><span class="va">mosa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">timeserie_path</span>, full.names <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<p>Check the crown file compatibility (Fig 2), <a href="https://umr-amap.github.io/canObsR/reference/Create-compatible-crown-delineation-file.html">(more
details here)</a></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">crownFile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">read_sf</a></span><span class="op">(</span><span class="va">crownFile_path</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/check_crownFile.html">check_crownFile</a></span><span class="op">(</span><span class="va">crownFile</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="img/file_compatibility.jpg" alt="Fig 2 : Crown file compatibility" width="50%"><p class="caption">
Fig 2 : Crown file compatibility
</p>
</div>
<p>Extract individual crown images to the ‘canObsR_data2/4_crowns_img’
folder. For the test dataset it can take fiew minutes.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="../reference/extract_crownImages.html">extract_crownImages</a></span><span class="op">(</span></span>
<span>   path_images <span class="op">=</span> <span class="va">mosa</span>,                                         <span class="co"># Path to mosaics</span></span>
<span>   path_crowns <span class="op">=</span> <span class="va">crownFile_path</span>,                          <span class="co"># Path to  crowns file</span></span>
<span>   out_dir_path <span class="op">=</span>  <span class="va">imgs_folder</span>,                         <span class="co"># Path to output folder</span></span>
<span>   tempdir_custom <span class="op">=</span> <span class="va">Tmpfiles_directory</span>,             <span class="co"># Path to tmp file directory</span></span>
<span>   dates <span class="op">=</span> <span class="va">dates</span>,                                  <span class="co"># dates of time series images</span></span>
<span>   N_cores <span class="op">=</span> <span class="va">N_cores</span>,                                          <span class="co"># Number of cores </span></span>
<span>   width <span class="op">=</span> <span class="fl">720</span>,                                           <span class="co"># By default it is 720 </span></span>
<span>   height <span class="op">=</span> <span class="fl">825</span>                                           <span class="co"># By default it is 720 </span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="create-labeling-file">Create labeling file<a class="anchor" aria-label="anchor" href="#create-labeling-file"></a>
</h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/create_labelingFile.html">create_labelingFile</a></span><span class="op">(</span></span>
<span>   crownFile <span class="op">=</span> <span class="va">crownFile</span>,          <span class="co"># Path to  crown file</span></span>
<span>   site <span class="op">=</span> <span class="va">site</span>,                           <span class="co"># Site name</span></span>
<span>   dates <span class="op">=</span> <span class="va">dates</span>,                         <span class="co"># Dates of the RGB survey</span></span>
<span>   out_dir_path <span class="op">=</span> <span class="va">canObsR_data2_folder</span><span class="op">)</span>   <span class="co"># Path to output folder</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="do-labeling-with-the-app">Do labeling with the app<a class="anchor" aria-label="anchor" href="#do-labeling-with-the-app"></a>
</h3>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="../reference/shiny_labels.html">shiny_labels</a></span><span class="op">(</span></span>
<span>   labelingFile <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span></span>
<span>      <span class="va">canObsR_data2_folder</span>, </span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">site</span>, <span class="st">"_WideLabels_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.Date</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"%Y%m%d"</span><span class="op">)</span>, <span class="st">".xlsx"</span><span class="op">)</span></span>
<span>      <span class="op">)</span>,</span>
<span>   imgFolder <span class="op">=</span> <span class="va">imgs_folder</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Hugo Leblanc.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>



  pkgdown/footer.html

  
</body>
</html>
